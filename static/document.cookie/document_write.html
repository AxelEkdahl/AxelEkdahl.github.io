<!doctype html>
<html>
<head>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<title>DOM XSS Test bench</title>
</head>
<body>
<h1>Test case: <br>
	document.cookie -> document.write</h1>
<hr>
	<b>Source:</b> document.cookie <br>
	<b>Sink:</b> document.write:<hr>
    <p><i>Enter the following code in the alert to insert malicious code into the cookie : 
    	<br>&lt;img src=foo onerror=alert()&gt;</i></p>
    <hr />
    <div class="row">
      <div class="col-md-7 form-group">
        <div class="col-md-2">
          <button class="form-control btn btn-primary" id="resetBtn" value="Enter">Reset cookie</button>
        </div>
        <div class="col-md-2">
        <button class="form-control btn btn-primary" id="showBtn" value="Enter">Enter/Show cookie</button>
    	</div>
      </div>
    </div>

<script>

checkCookie();

 var btn = document.getElementById('resetBtn');
    btn.addEventListener('click', function(){
    	setCookie("username","",-1)
    });

 var btn = document.getElementById('showBtn');
    btn.addEventListener('click', function(){
    	checkCookie()
    });


function setCookie(cname, cvalue, exdays) {
    var d = new Date();
    d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
    var expires = "expires="+d.toUTCString();
    document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
}

function getCookie(cname) {
    var name = cname + "=";
    var ca = document.cookie.split(';');
    for(var i = 0; i < ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == ' ') {
            c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
        }
    }
    return "";
}

function checkCookie() {
    var user = getCookie("username");
    if (user != "") {
        document.write("Welcome again: " + user);
    } else {
        user = prompt("Please enter your name:", "");
        if (user != "" && user != null) {
            setCookie("username", user, 365);
        }
    }
} 
</script>

<hr>
<h2>Code<h2>
<code>
	<pre>
&#x3C;!doctype html&#x3E;
&#x3C;html&#x3E;
&#x3C;head&#x3E;
&#x3C;link rel=&#x22;stylesheet&#x22; href=&#x22;https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css&#x22; integrity=&#x22;sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u&#x22; crossorigin=&#x22;anonymous&#x22;&#x3E;
&#x3C;title&#x3E;DOM XSS Test bench&#x3C;/title&#x3E;
&#x3C;/head&#x3E;
&#x3C;body&#x3E;
&#x3C;h1&#x3E;Test case: &#x3C;br&#x3E;
&#x9;document.cookie -&#x3E; document.write&#x3C;/h1&#x3E;
&#x3C;hr&#x3E;
&#x9;&#x3C;b&#x3E;Source:&#x3C;/b&#x3E; document.cookie &#x3C;br&#x3E;
&#x9;&#x3C;b&#x3E;Sink:&#x3C;/b&#x3E; document.write:&#x3C;hr&#x3E;
    &#x3C;p&#x3E;&#x3C;i&#x3E;Enter the following code in the alert to insert malicious code into the cookie : 
    &#x9;&#x3C;br&#x3E;&#x26;lt;img src=foo onerror=alert()&#x26;gt;&#x3C;/i&#x3E;&#x3C;/p&#x3E;
    &#x3C;hr /&#x3E;
    &#x3C;div class=&#x22;row&#x22;&#x3E;
      &#x3C;div class=&#x22;col-md-7 form-group&#x22;&#x3E;
        &#x3C;div class=&#x22;col-md-2&#x22;&#x3E;
          &#x3C;button class=&#x22;form-control btn btn-primary&#x22; id=&#x22;resetBtn&#x22; value=&#x22;Enter&#x22;&#x3E;Reset cookie&#x3C;/button&#x3E;
        &#x3C;/div&#x3E;
        &#x3C;div class=&#x22;col-md-2&#x22;&#x3E;
        &#x3C;button class=&#x22;form-control btn btn-primary&#x22; id=&#x22;showBtn&#x22; value=&#x22;Enter&#x22;&#x3E;Enter/Show cookie&#x3C;/button&#x3E;
    &#x9;&#x3C;/div&#x3E;
      &#x3C;/div&#x3E;
    &#x3C;/div&#x3E;

&#x3C;script&#x3E;

checkCookie();

 var btn = document.getElementById(&#x27;resetBtn&#x27;);
    btn.addEventListener(&#x27;click&#x27;, function(){
    &#x9;setCookie(&#x22;username&#x22;,&#x22;&#x22;,-1)
    });

 var btn = document.getElementById(&#x27;showBtn&#x27;);
    btn.addEventListener(&#x27;click&#x27;, function(){
    &#x9;checkCookie()
    });


function setCookie(cname, cvalue, exdays) {
    var d = new Date();
    d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
    var expires = &#x22;expires=&#x22;+d.toUTCString();
    document.cookie = cname + &#x22;=&#x22; + cvalue + &#x22;;&#x22; + expires + &#x22;;path=/&#x22;;
}

function getCookie(cname) {
    var name = cname + &#x22;=&#x22;;
    var ca = document.cookie.split(&#x27;;&#x27;);
    for(var i = 0; i &#x3C; ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == &#x27; &#x27;) {
            c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
        }
    }
    return &#x22;&#x22;;
}

function checkCookie() {
    var user = getCookie(&#x22;username&#x22;);
    if (user != &#x22;&#x22;) {
        document.write(&#x22;Welcome again: &#x22; + user);
    } else {
        user = prompt(&#x22;Please enter your name:&#x22;, &#x22;&#x22;);
        if (user != &#x22;&#x22; &#x26;&#x26; user != null) {
            setCookie(&#x22;username&#x22;, user, 365);
        }
    }
} 
&#x3C;/script&#x3E;

&#x3C;hr&#x3E;
&#x3C;/body&#x3E;
&#x3C;/html&#x3E;
	</pre>
</code>
</body>
</html>